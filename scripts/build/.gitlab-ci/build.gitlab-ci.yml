.build-image:
  services:
    - docker:dind
  before_script:
    - apk update && apk add bash
    - docker login  $CI_REGISTRY -u gitlab-ci-token -p $CI_JOB_TOKEN
  after_script:
    - docker logout

build-base:
  stage: "build and push base image"
  extends: .build-image
  script:
    - bash ./scripts/build/base/base.build-dev.sh --push=1 --registry-image=$registry_image --docker-node-image=$docker_node_image


build-base-dependencies:
  stage: "build and push base-dependencies image"
  extends: .build-image
  script:
    - bash ./scripts/build/base-dependencies/base-dependencies.build.sh --registry-image=$registry_image --version=$app_version --push=1

build-tremplin-app:
  stage: "build and push tremplin images"
  extends: .build-image
  script:
    - bash ./scripts/build/app-build/app.build.sh --branch-or-tag=$branch_or_tag --registry-image=$registry_image --version=$app_version --push=1 --docker-node-image=$docker_node_image

build-tremplin-api:
  stage: "build and push tremplin images"
  extends: .build-image
  script:
    - bash ./scripts/build/api-build/api.build.sh --branch-or-tag=$branch_or_tag --registry-image=$registry_image --version=$app_version --push=1 --docker-node-image=$docker_node_image

