.build-image:
  image: docker:latest
  services:
    - docker:dind
  before_script:
    - apk update && apk add bash
    - docker login  $CI_REGISTRY -u gitlab-ci-token -p $CI_JOB_TOKEN
  after_script:
    - docker logout

build-base:
  stage: "build and push base image"
  extends: .build-image
  script:
    - bash ./scripts/build/base/base.build-dev.sh --push=1 --registry-image=$registry_image


build-base-dependencies:
  stage: "build and push base-dependencies image"
  extends: .build-image
  script:
    - bash ./scripts/build/base-dependencies/base-dependencies.build.sh --version=$app_version --push=1

# build-tremplin-app:
#   before_script:
#     - docker login  $CI_REGISTRY -u gitlab-ci-token -p $CI_JOB_TOKEN
#   script:
#     - bash ./scripts/build/app-build/app.build.sh --version=$app_version --push=1
#   after_script:
#     - docker logout
#   stage: "build and push tremplin images"
#   only:
#   - docker_builds

# build-tremplin-api:
#   before_script:
#     - docker login  $CI_REGISTRY -u gitlab-ci-token -p $CI_JOB_TOKEN
#   script:
#     - bash ./scripts/build/api-build/api.build.sh --version=$app_version --push=1
#   after_script:
#     - docker logout
#   stage: "build and push tremplin images"
#   only:
# - docker_builds

