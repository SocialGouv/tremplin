---
variables:
# https://docs.gitlab.com/ce/ci/variables/README.html
  DOCKER_HOST: tcp://localhost:2375
  DOCKER_VERSION: 18.06

image: docker:$DOCKER_VERSION

stages:
  - "Build and Push Docker Image"

build-and-push-tremplin-api-image:
  stage: "Build and Push Docker Image"
  before_script:
  - cd packages/api
  - docker login  $CI_REGISTRY -u gitlab-ci-token -p $CI_JOB_TOKEN
  script:
  - docker build -t "$CI_REGISTRY_IMAGE/api:$CI_COMMIT_SHA" .
  - docker push "$CI_REGISTRY_IMAGE/api:$CI_COMMIT_SHA"

build-and-push-tremplin-app-image:
  stage: "Build and Push Docker Image"
  before_script:
  - cd packages/app
  - docker login  $CI_REGISTRY -u gitlab-ci-token -p $CI_JOB_TOKEN
  script:
  - docker build -t "$CI_REGISTRY_IMAGE/app:$CI_COMMIT_SHA" .
  - docker push "$CI_REGISTRY_IMAGE/app:$CI_COMMIT_SHA"
